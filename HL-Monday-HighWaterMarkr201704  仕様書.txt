★HL-Monday-HighWaterMark201704  仕様書


▲HL-Monday-Order201703に資金管理でHighWaterMarkを付け加えたものです。



★概要★
月曜日の高値、底値を更新したら、エントリーするＥＡです。（ＨＬはハイ・ローの意味です）
エントリーは同一方向に２つずつで、両方共ＳＬはありますが、ＴＰは１つしか設定しません。
ＴＰ以上のトレンドで利益を得るためです。金曜日の相場が終わる直前にクローズします。

稼働すると、月曜日の高値、底値を見て、buy stopが２つ、sell stopが２つ入ります。
ロット数、ＳＬ、ＴＰも計算式によって導かれます。






-----------------------
エントリーロット設定
-----------------------

・固定lot設定 (0.01)



▲追加ここから　ハイオォーターマーク設定▲
・HighWaterMark  (ture)
・Start Funds  (1,000,000) ０の場合は、現在の口座残高を読み取って設定。
・Pool Percent Ratio (50)


チャートに下記の数字を表示お願い致します。

Start Funds　（最初の設定から変わることはありません）
Pool Funds
Entry Funds


まず、Start Funds を読み込みます。
一番最初はこれがそのままEntry Fundsになり、このEntry Fundsの数値がMM設定及びAuto lot時の現在の資金として計算していきます。


次の計算は月曜日を超えたときです。（新しいHLラインができた時＝週に一回の更新となります。
（この影響で、一週間は資金が増えても減っても同じロット数でエントリーするこになります）


＜先週から資金が減った場合＞
Entry Fundsはそのままです。つまり資金に対して多少レバレッジが高くなります。

＜先週から資金が増えた場合＞
増えた資金のPool Percent Ratio分だけPool Fundsにおきます。
資金が５０００円増えて５０％だった場合は、２５００円がPool Fundsになります。
そして、Entry Fundsは現在の段高からPool Fundsを差し引いた分の資金に対してMMロット数をかけていきます。


※資金が増えれば増えるほどドローダウンもドローアップも減ってきますが、Pool Fundsが増えていきます。


▲追加ここまで　ハイオォーターマーク設定▲



・MM　複利設定 (false)
・MM 設定 per0.01 (100,000)
指定資金ごとに0.01lot積み増ししてロット数をあげていく。
例）20万だったら、0.02lot、30万なら0.03lot。


・Auto lot (ture)
・Auto lot Adjust times（1.0)
（現在の資金×0.0000001 / Width to launch）x (Auto lot Adjust times)
0.01lot未満は四捨五入

Width to launchの数値は下記にでてきますので、ご参照ください。
例えば現在の資金が１０万円で下記の例だとWidth to launch が0.334になりますので、
100,000 x 0.0000001 / 0.334 x 1.0 =0.02994...
ですので、0.03lotになります。
（取引先が１lot＝通貨数によってAuto lot Adjust timeを0.1にしたり10にしたり、ハイレバなら3.0などに変動）

MM設定とAuto lot が両方共tureになってしまったらAuto lot 優先でお願いします。

-----------------------
時間設定
-----------------------
GMT shift (2)
base period Friday hour shift （0)

GMT shiftはGMTオフセット値です。冬時間はサーバー＋２時間、夏時間はサーバー＋３時間です。
プログラムとしてオフセットが必要なければ不要です。
base period Friday hour shift は相場が閉まる時間の調整です。

-----------------------
各種パラメーター
-----------------------

Divided by Width to launch  (3.0)
TP Width to launch times (2.0)
Buy Entry  adjust pips  (1.5)
Buy SL adjust pips  (1.0)
Buy TP adjust pips  (1.0)
Sell Entry adjust pips  (1.0)
Sell SL adjust pips  (1.0)
Sell TP adjust pips  (1.0)




まず、その週の月曜日の相場をチェックしに行き、火曜日以降に計４つの逆指値注文、
金曜日に最終決済になります。
（月曜日＝日本時間でいうと月曜日6:00am〜火曜日5:59amです）
例えば、月曜日の高値が100.000、安値が99.000だとします。
そして、その差をdivided by Width to launch  で割った数値が
仕掛値（Width to launch）になります。割り切れない場合は切り上げです。

チャートの端っこに（左上？）そのレートを表示、Last exitの項目にFridayと表示
できると嬉しいです。
High price  100.000
Low price   99.000
Width to launch  0.334   ((100.000-99.000)/3.0=0.3333)


まずはbuy方向のセットです。
Monday High price + Buy adjust pips　に２つ逆指値を入れます。
100.000+1.5pipsなので100.015 にBuyが２つ。
２つとも逆指値から仕掛値（Width to launch）とSL adjust pipsを引いたところにストップリストを入れます。
100.015 - 0.334 - 0.01(1.0pips) = 99.671

次にTPは１つだけ入れます。
TPは逆指値から、仕掛値（Width to launch）のTP Width to launch timesをかけたものと
Buy TP adjust pipsを足したところに入れます。
100.015 + (0.334x2.0) + 0.01(1.0pips) = 100.693
もう１つはTPを入れず放置します。



次にSell方向のセットです。
Monday Low price - Sell adjust pips　に２つ逆指値を入れます。
99.000 - 1.0pops なので 98.990 にsellが２つ。
２つとも逆指値から仕掛値（Width to launch）とSL adjust pipsを足したところにストップリストを入れます。
98.990 + 0.334 + 0.01(1.0pips) = 99.334
次にTPは１つだけ入れます。

TPは逆指値から、仕掛値（Width to launch）のTP Width to launch timesをかけたものと
Sell TP adjust pipsを引いたところに入れます。
98.990 - (0.334x2.0) - 0.01(1.0pips) = 98.312
もう１つはTPを入れず放置します。


Buyが２つ共ＳＬにかかった場合、再びBuy方向に同じ逆指値を２つ入れてください。
ロット数は再計算です。
（１つだけTPに刺さり、もう１つが残っている場合は入れない）。
Sellも２つ共ＳＬにかかった場合、再びSell方向に同じ逆指値を２つ入れてください。
ロット数は再計算です。
（１つだけTPに刺さり、もう１つが残っている場合は入れない）。




残った最後のエクジットですが、相場が閉まる直前に成り行きで決算します。
日本時間でいうと土曜日5:59に成り行きができればと思います。
ただ、ブローカーによっては朝４時に終わるなどがあるので、
それにそなえて、base period Friday hour shift で１時間単位で、早められるようにしてください。
「１」でしたら4:59に成り行き決済、「２」でしたら3:59に成り行きです。


翌週になったら月曜日は何もしません。
月曜日の高値・安値を見て、火曜日６時過ぎ（冬時間は７時）に逆指値を４本入れます。
これを毎週繰り返していきます。



※仮にEAを稼働させたのが木曜日で、高値もしくは安値が更新していても
　月曜日の高値・安値をチェックして４つの逆指値を入れてください。
　（逆指値予約ができないケースもありますが（逆指値100.015で現在地が101.000などの場合）、
　　理想としては逆指値ができる金額まで戻ってきたら予約したいです）





