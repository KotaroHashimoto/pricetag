★PERFECT_Order_EA 仕様書

★概要★
パラメータがいろいろ変更できるパーフェクトオーダーＥＡです。条件によっては細かく利益をとって何度も繰り返しエントリーすることもあります。HighWaterMarkの資金管理で勝率５割、リスクリワード１：１でも資金が増えていくようにするＥＡです。


-----------------------
エントリーロット設定
-----------------------

・マジックナンバー (201707)
・固定lot設定 (0.01)
・MM 設定 per0.01 (100,000)
指定資金ごとに0.01lot積み増ししてロット数をあげていく。
例）20万だったら、0.02lot、30万なら0.03lot。


-----------------------
ハイオォーターマーク設定
-----------------------

・HighWaterMark  (ture)
・Start Funds  (1,000,000) ０の場合は、現在の口座残高を読み取って設定。
・Pool Percent Ratio (50)


チャートに下記の数字を表示お願い致します。

Start Funds　（最初の設定から変わることはありません）
Pool Funds
Entry Funds


＜初期動作＞
まず、Start Funds を読み込みます。
ここが０の場合は現在の口座残高を読み取ってください。

（ａ）Start Funds＝現在の口座残高　なら、
Pool Fundsは０に、Start Funds＝Entry Fundsにします。

（ｂ）Start Funds＜現在の口座残高　なら、
（現在の口座残高 - Start Funds）ｘ　Pool Percent Ratio（％）　の金額をPool Fundsに、
現在の口座残高 - Pool Funds　を Entry Fundsにします。

（ｃ）Start Funds＞現在の口座残高　なら、
（現在の口座残高 - Start Funds）ｘ　Pool Percent Ratio（％）　の金額をPool Fundsに、（マイナス表示）
Pool Fundsは０に、Start Funds＝Entry Fundsにします。
※この場合、計算がどんどん狂ってきてしまうと思いますが、この設定は想定していないので仕様上のバグありでOKです。
　理論上はStart Funds＝現在の口座残高になった時点で（ａ）（ｂ）に移行するのですが、
　使わない予定なので、そこまでプログラム入れなくてもいいかなと思っています。


＜資金が減った場合＞
Entry Fundsはそのままです。つまり資金に対して多少ロット数が高くなります。

＜資金が増えた場合＞
増えた資金のPool Percent Ratio分だけPool Fundsにおきます。
資金が５０００円増えて５０％だった場合は、２５００円がPool Fundsになります。
そして、Entry Fundsは現在の段高からPool Fundsを差し引いた分の資金に対してMMロット数をかけていきます。


※資金が増えれば増えるほどドローダウンもドローアップも減ってきますが、Pool Fundsが増えていきます。
※資金が増えているときは、必ず現在の口座残高＝Pool Funds＋Entry Fundsになります。


-----------------------
移動平均線の設定
-----------------------

MA type  (SMA/EMA/WMA)  (SMA)

長期線　long MA period  (200)　　
中期線　Mid MA period (62)
短期線　Short MA period  (20)


ＭＡの種類をＳＭＡ／ＥＭＡ／ＷＭＡから選択できるようにして、３本の設定値を入力します。


-----------------------
エントリーの設定
-----------------------

まず前提条件として、長期・中期・短期が順番に並んでいるパーフェクトオーダー状態の時のみです。


Slope check (ture)

perfect soon entry (fales)
Tick decided Entry (fales)



Slope checkがtureの場合、同一方向に傾いている時のみのエントリーになります。
長期・中期・短期が下から順番に並んでいるが、長期・中期は上を向いていて短期が下を向いていたらエントリーしません。
falesの場合は無視します。
プログラムとしては、前の足との価格差のプラスマイナスで行うのがいいかと思います。




実際のエントリーポイントは２ｘ２から選択です。

perfect soon entry (ture)の場合はＭＡでパーフェクトオーダーの形が成立した時点でエントリーです。
Tick decided Entry (ture)の時は、今の足が完成して次の足に行ったときに形成していたらエントリー、
Tick decided Entry (fales)の時は、足が作られている途中でもすぐにエントリーします。

perfect soon entry (fales)の場合はＭＡでパーフェクトオーダーの形が成立しつつ、
「短期線に一度入って現在値が抜けた時」です。
perfect-soon-entry.jpgをご覧いただけるとわかりやすいかと思います！
ピンクの○の部分で、短期戦に一度入って抜けているのが確認できるかと思います。
Tick decided Entry (ture)の時は、抜けた足が完成して終値が抜けていることを確認したらエントリー、
Tick decided Entry (fales)の時は、足が作られている途中でも抜けたらすぐにエントリーします。



-----------------------
エクジットの設定
-----------------------

exit tick number (3)
exit loss hold (ture)

TP pips (0)
SL pips  (50)
safe SL pips (20)
trailing stop （ture)
trailing stop pips (40)


決済は、確定足で短期線を連続でexit tick number分になったときです。（決済は足が確定した時のみでｏｋです！）
短期線を下回る（上回る）確定が連続で設定値分（初期設定だと３足）出たときに決済です。
perfect-soon-entry.jpgをご覧いただけるとわかりやすいかと思います！
赤い色で３本連続設定値分短期線に入り込んでいますので、ここで決済です。

ただし、exit loss hold (ture)の場合、損益がマイナスになっている場合は決済を行いません。
この場合、再び設定値分連続で決済になるのを待ちます。
さらにそこで損益がマイナスになっている場合は、さらに待ちます。
つまり、プラスになるかＳＬに引っかかるまで待ちます。


TP pips　 (0)は最初に入れるＴＰ値です。０の場合は入れません。
SL pips  (50)は最初に入れるＳＬ値です。
safe SL pips (20)は、設定値分上がったら、建値＋（設定値／５）の部分にＳＬをおきます。
この場合、20pips利益が乗ったら、建値+4pips(20/5)にＳＬを変更します。

trailing stop （ture)はトレーリングストップ設定です。
設定値の２倍利益がのったら、建値＋設定値にＳＬをおいてください。



-----------------------
時間強制決済設定
-----------------------
Saturday exit (fales)
hour set （4)

損益がどうであろうと、土曜日朝に強制決済させる項目です。
４の場合、日本時間３：５５に決済してくれると嬉しいですが、このあたりは
プログラムで書きやすいように設定していただいて大丈夫です！




-----------------------
連続して買った場合の待ち設定　（相談）
-----------------------

succession (ture)
succession times (3)

ここは実装できるかどうかご相談です。できない場合はできなくても大丈夫です。
上記パーフェクトオーダーは長いトレンドの場合、同じ方向で何度もエントリーとエクジットを繰り返すことがあります。
そして、最後はだいたい負けて終わりますので、
連続して（設定値分）勝ったら、その方向でのエントリーは終了し、逆方向のエントリーチャンスが出るまで待つ設定です。







